@import com.lightbend.docs.Context
@import com.lightbend.lagom.docs.VersionPage
@import com.lightbend.lagom.docs.Section
@import com.lightbend.lagom.docs.LagomContext
@import com.lightbend.lagom.docs.NavLink

@(path: String, content: Html, context: Context, language: String, version: String, versions: Seq[VersionPage], nav: List[Section],
        canonical: Option[String], nextLinks: Seq[NavLink])(implicit ctx: LagomContext)

@main(Some(context.title), canonical) { @* Header *@
    <link rel="stylesheet" href="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />
    @for(css <- context.resources.stylesheets) {<link rel="stylesheet" type="text/css" href="@css"/>
    }
} { @* Footer *@
    <script type="text/javascript" src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
        <!-- Cross-site search. This is using Algolia's autocomplete.js  -->
    <script>
            var clientLagom = algoliasearch('BH4D9OD16A', '77ef1e29e6bddfca861f7a42cc51725e');
            var clientAkka  = algoliasearch('BH4D9OD16A', '543bad5ad786495d9ccd445ed34ed082');
            var clientPlay  = algoliasearch('BH4D9OD16A', 'a0b34e68c804cf96e76adcb02d47159b');
            var lagomIndex = clientLagom.initIndex('lagomframework');
            var akkaIndex  = clientAkka.initIndex('akka_io');
            var playIndex  = clientPlay.initIndex('playframework');

            var displayValue = function (suggestion, level) {
                if (level === 0)
                    return suggestion._highlightResult.hierarchy.lvl0.value;
                if (suggestion._highlightResult.hierarchy['lvl' + level] !== undefined) {
                    return suggestion._highlightResult.hierarchy['lvl' + level].value ;
                } else {
                    return displayValue(suggestion, level - 1) ;
                }
            };
            var displaySnippet = function (suggestion) {
              if(typeof suggestion._snippetResult !== 'undefined'){
                return '<div class="algolia-docsearch-suggestion--text">' + suggestion._snippetResult.content.value + '</div>'
              } else {
                return ''
              }
            }

            autocomplete('#cross-docs-search',
                    { hint: false },
                    [
                    // configure Lagom's index
                    {
                        source: autocomplete.sources.hits(lagomIndex,
                                {
                                    hitsPerPage: 5,
                                    facetFilters: [
                                        'language:scala', // TODO: parameterize
                                        'version:current' ]
                                }),
                        templates: {
                            header: '<span class="algolia-docsearch-suggestion algolia-docsearch-suggestion__main algolia-docsearch-suggestion__secondary algolia-docsearch-suggestion--category-header ">Lagom Documentation</span>',
                            suggestion: function(suggestion) {
                                return  '<div class="algolia-docsearch-suggestion algolia-docsearch-suggestion__secondary" style="white-space: normal;">' +
                                 '<div class="algolia-docsearch-suggestion--wrapper">' +
                                    '<div class="algolia-docsearch-suggestion--subcategory-column ">' +
                                        '<span class="algolia-docsearch-suggestion--subcategory-column-text">' + displayValue(suggestion, 0) + '</span>' +
                                    '</div>' +
                                    '<div class="algolia-docsearch-suggestion--content">' +
                                        '<div class="algolia-docsearch-suggestion--subcategory-inline ">' + displayValue(suggestion, 1) + '</div>' +
                                        '<div class="algolia-docsearch-suggestion--title algolia-docsearch-suggestion--duplicate-content">' + displayValue(suggestion, 2)  +'</div>' +
                                        displaySnippet(suggestion) +
                                    '</div>' +
                                '</div>'+
                              '</div>';
                            }
                        }
                    }
                    ,
                    // configure Akka's index
                    {
                        source: autocomplete.sources.hits(akkaIndex,
                                {
                                    hitsPerPage: 2,
                                    facetFilters: ['language:scala'] // TODO: parameterize
                                    // akka_io only indexes 'current'
                                }),
                        templates: {
                            header: '<span class="akka"><span class="algolia-docsearch-suggestion algolia-docsearch-suggestion--category-header ">Akka Documentation</span></span>',
                            //'suggestion' templating function used to render a single suggestion
                            suggestion: function(suggestion) {
                                return '<span class="akka">'+
                                '<div class="algolia-docsearch-suggestion algolia-docsearch-suggestion__secondary" style="white-space: normal;">' +
                                        '<div class="algolia-docsearch-suggestion--wrapper">' +
                                        '<div class="algolia-docsearch-suggestion--subcategory-column ">' +
                                        '<span class="algolia-docsearch-suggestion--subcategory-column-text">' + displayValue(suggestion, 0) + '</span>' +
                                        '</div>' +
                                        '<div class="algolia-docsearch-suggestion--content">' +
                                        '<div class="algolia-docsearch-suggestion--subcategory-inline ">' + displayValue(suggestion, 1) + '</div>' +
                                        '<div class="algolia-docsearch-suggestion--title algolia-docsearch-suggestion--duplicate-content">' + displayValue(suggestion, 2)  +'</div>' +
                                        displaySnippet(suggestion) +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</span>';
                            }
                        }
                    }
                    ,
                    // configure Play's index
                    {
                        source: autocomplete.sources.hits(playIndex,
                                {
                                    hitsPerPage: 2,
                                    facetFilters: ['version:2.6.x', 'tags:en']
                                }),
                        templates: {
                            // last item on the list must include the algolia footer
                            footer: '<div class="algolia-docsearch-footer"><a class="algolia-docsearch-footer--logo" href="https://www.algolia.com/docsearch">Algolia</a></div>',
                            header: '<span class="play"><span class="algolia-docsearch-suggestion algolia-docsearch-suggestion--category-header ">Play Documentation</span></span>',
                            //'suggestion' templating function used to render a single suggestion
                            suggestion: function(suggestion) {
                                return '<span class="play">'+
                                '<div class="algolia-docsearch-suggestion algolia-docsearch-suggestion__secondary" style="white-space: normal;">' +
                                        '<div class="algolia-docsearch-suggestion--wrapper">' +
                                        '<div class="algolia-docsearch-suggestion--subcategory-column ">' +
                                        '<span class="algolia-docsearch-suggestion--subcategory-column-text">' + displayValue(suggestion, 0) + '</span>' +
                                        '</div>' +
                                        '<div class="algolia-docsearch-suggestion--content">' +
                                        '<div class="algolia-docsearch-suggestion--subcategory-inline ">' + displayValue(suggestion, 1) + '</div>' +
                                        '<div class="algolia-docsearch-suggestion--title algolia-docsearch-suggestion--duplicate-content">' + displayValue(suggestion, 2)  +'</div>' +
                                        displaySnippet(suggestion) +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</span>';
                            }
                        }
                    }
                    ]
                    ).on('autocomplete:selected', function(event, suggestion, dataset) {
                              location.href = suggestion.url;
                    });
    </script>



    @for(script <- context.resources.scripts) {<script type="text/javascript" src="@script"></script>
    }
} {  @* Body *@
    <header class="fw-wrapper lgm-purple page-title">
        <div class="row">
            <div class="small-12 columns">
                <h1>@context.title</h1>
            </div>
        </div>
    </header>

    <div class="fw-wrapper documentation-content">
        <div class="row">
            <div class="small-12 large-7 columns">
                @if(nav.size > 1) {
                    <nav class="breadcrumbs">
                        <a href="@nav.head.url">@nav.head.title</a>
                        @for(section <- nav.drop(1)) {
                            &raquo; <a href="@section.url">@section.title</a>
                        }
                    </nav>
                }

                <article>
                @content
                </article>

                @if(nextLinks.nonEmpty) {
                    @if(nextLinks.tail.nonEmpty) {
                        <nav class="next-links">
                            <strong>Next:</strong>
                            <ul>
                            @for(link <- nextLinks) {
                                <li><a href="@{link.url}">@link.title</a></li>
                            }
                            </ul>
                        </nav>
                    } else {
                        @for(link <- nextLinks) {
                            <nav class="next-link">
                                <a href="@{link.url}"><strong>Next: </strong> @link.title</a>
                            </nav>
                        }
                    }
                }

                @for(sourceUrl <- context.sourceUrl) {
                    <p class="edit-source">Found an error in this documentation? The source code for this page can be found
                        <a href="@sourceUrl">here</a>. Please feel free to edit and contribute a pull request.</p>
                }
            </div>
            <aside class="small-12 large-4 columns">
                <nav class="side-menu">

                    <input type="search" id="cross-docs-search" placeholder="Search..." />

                    <label for="docs-version">Version:</label>
                    <select id="docs-version">
                    @for(v <- versions) {
                        <option value="@ctx.path/documentation/@v.name/@language@if(v.exists){/@path}else{/Home.html}"@if(v.name == version){ selected="selected"}>@v.name</option>
                    }
                    </select>

                    <a href="@ctx.path/documentation/@version/@language/api/index.html" class="api-docs">API Documentation</a>

                    @for(section <- nav.reverse) {
                        <h3>@section.title</h3>
                        <ul>
                        @for(link <- section.children) {
                            @if(link.current) {
                                <li class="current-page"><a href="@link.url">@link.title</a></li>
                            } else {
                                <li><a href="@link.url">@link.title</a></li>
                            }
                        }
                        </ul>
                    }
                </nav>
            </aside>
        </div>
   </div>
}
